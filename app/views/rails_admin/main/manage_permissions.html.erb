<% content_for :title do %>
  <%= t('admin.actions.manage_permissions.title') %>
<% end %>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><%= t('admin.actions.manage_permissions.title') %></h3>
        </div>
        <div class="card-body">
          <div class="alert alert-success d-none" role="alert" data-permissions-form-target="successMessage">
            Permissions updated successfully!
          </div>

          <%= form_tag manage_permissions_path, method: :post, class: 'form', 
              data: { 
                controller: 'permissions-form',
                action: 'submit->permissions-form#handleSubmit'
              } do %>
            <div class="form-group mb-3">
              <label for="user_id">User</label>
              <%= select_tag :user_id, 
                           options_from_collection_for_select(@users, :id, :email),
                           class: 'form-control',
                           prompt: 'Select User',
                           required: true,
                           data: { permissions_form_target: 'user' } %>
            </div>

            <div class="form-group mb-3">
              <label for="resource_name">Resource</label>
              <%= select_tag :resource_name, 
                           options_for_select(@resource_names),
                           class: 'form-control',
                           prompt: 'Select Resource',
                           required: true,
                           data: { permissions_form_target: 'resource' } %>
            </div>

            <div class="form-group mb-3">
              <label>Permissions</label>
              <div class="permissions-list">
                <%= select_tag :permission_ids, 
                             options_from_collection_for_select(@permissions, :id, :name),
                             class: 'form-control',
                             multiple: true,
                             size: 10,
                             data: { permissions_form_target: 'permissions' } %>
              </div>
              <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple permissions</small>
            </div>

            <div class="form-group">
              <%= button_tag type: 'submit', class: 'btn btn-primary', data: { permissions_form_target: 'submitButton' } do %>
                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" data-permissions-form-target="spinner"></span>
                <span data-permissions-form-target="buttonText">Save Permissions</span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :head do %>
  <style>
    .permissions-list {
      margin-bottom: 10px;
    }
    .permissions-list select {
      width: 100%;
    }
  </style>
<% end %>

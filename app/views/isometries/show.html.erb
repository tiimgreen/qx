<%= render 'breadcrumb', breadcrumbs: [
  { text: @project.name, path: project_path(@project) },
  { text: t('navigation.menu.isometries.title'), path: project_isometries_path(@project) },
  { text: @isometry.line_id }
] %>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2"><%= @isometry.line_id %></h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <% if current_user.can_edit?("Isometry") %>
      <%= link_to edit_project_isometry_path(@project, @isometry), class: "btn btn-sm btn-outline-secondary me-2" do %>
        <i class="bi bi-pencil"></i> <%= t('common.actions.edit') %>
      <% end %>
    <% end %>
    <% if current_user.can_delete?("Isometry") %>
      <%= link_to project_isometry_path(@project, @isometry),
            method: :delete,
            data: { confirm: t('common.messages.confirm_delete') },
            class: "btn btn-sm btn-outline-danger" do %>
        <i class="bi bi-trash"></i> <%= t('common.actions.delete') %>
      <% end %>
    <% end %>
  </div>
</div>

<div class="row mb-4">
  <!-- Technical Specifications -->
  <h5 class="border-bottom pb-2 mb-3"><%= t('.technical_specs') %></h5>

  <div class="col-md-6 mb-4">
    <dl class="row">
      <dt class="col-sm-4"><%= t('.received_date') %></dt>
      <dd class="col-sm-8"><%= l(@isometry.received_date, format: :short) if @isometry.received_date %></dd>

      <dt class="col-sm-4"><%= t('.pid_number') %></dt>
      <dd class="col-sm-8"><%= @isometry.pid_number %></dd>

      <dt class="col-sm-4"><%= t('.pid_revision') %></dt>
      <dd class="col-sm-8"> <%= @isometry.pid_revision %></dd>

      <dt class="col-sm-4"><%= t('.line_id') %></dt>
      <dd class="col-sm-8"><%= @isometry.line_id %></dd>

      <dt class="col-sm-4"><%= t('.revision') %></dt>
      <dd class="col-sm-8">
        <%= @isometry.revision_number %>
        <% if @isometry.revision_last %>
          <span class="badge bg-success"><%= t('.latest_revision') %></span>
        <% end %>
      </dd>

      <dt class="col-sm-4"><%= t('.page') %></dt>
      <dd class="col-sm-8"><%= @isometry.page_number %></dd>

      <dt class="col-sm-4"><%= t('.total_page') %></dt>
      <dd class="col-sm-8"><%= @isometry.page_total %></dd>
    </dl>
  </div>

  <div class="col-md-6 mb-4">
    <dl class="row">
      <dt class="col-sm-4"><%= t('.dn_measurements') %></dt>
      <dd class="col-sm-8">
        <% if @isometry.dn1.present? %>
          <div class="mb-1">
            <%= number_with_precision(@isometry.dn1, precision: 2) %> m
          </div>
        <% end %>
      </dd>

      <dt class="col-sm-4"><%= t('.pipe_class') %></dt>
      <dd class="col-sm-8"><%= @isometry.pipe_class %></dd>

      <dt class="col-sm-4"><%= t('.material') %></dt>
      <dd class="col-sm-8"><%= @isometry.material %></dd>

      <dt class="col-sm-4"><%= t('.system') %></dt>
      <dd class="col-sm-8"><%= @isometry.system %></dd>

      <dt class="col-sm-4"><%= t('.medium') %></dt>
      <dd class="col-sm-8"><%= @isometry.medium %></dd>

      <dt class="col-sm-4"><%= t('.work_package') %></dt>
      <dd class="col-sm-8"><%= @isometry.work_package_number %></dd>
    </dl>
  </div>
</div>

<!-- Material Certificates -->
<div class="row mb-4">
  <div class="col-12">
    <h5 class="border-bottom pb-2 mb-3"><%= t('.material_certificates') %></h5>
    <% if @isometry.material_certificates.any? %>
      <div class="row g-3">
        <% @isometry.material_certificates.each do |cert| %>
          <div class="col-md-2">
            <div class="d-flex flex-column position-relative border rounded p-2">
              <%= link_to material_certificate_path(cert), class: "text-decoration-none text-dark" do %>
                <div class="text-center mb-2">
                  <i class="bi bi-file-text" style="font-size: 2rem;"></i>
                </div>
                <div class="d-flex flex-column text-center">
                  <span class="fw-medium"><%= cert.certificate_number %></span>
                  <span class="text-secondary small"><%= cert.batch_number %></span>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted"><%= t('.no_certificates') %></p>
    <% end %>
  </div>
</div>

<!-- Additional Specifications -->
<div class="row mb-4">
  <div class="col-12">
    <h5 class="border-bottom pb-2 mb-3"><%= t('.additional_specs') %></h5>
  </div>
  
  <div class="col-md-4">
    <dl class="row">
      <dt class="col-sm-4"><%= t('.dp') %></dt>
      <dd class="col-sm-8">
        <%= "DP" if @isometry.dp %>
      </dd>
      <dt class="col-sm-4"><%= t('.dip') %></dt>
      <dd class="col-sm-8">
        <%= "DIP" if @isometry.dip %>
      </dd>

      <dt class="col-sm-4"><%= t('.isolation') %></dt>
      <dd class="col-sm-8"><%= @isometry.isolation_required? ? t('common.yes') : t('common.no') %></dd>

      <dt class="col-sm-4"><%= t('.gmp') %></dt>
      <dd class="col-sm-8">
        <%= "GMP" if @isometry.gmp %>
      </dd>
      <dt class="col-sm-4"><%= t('.gdp') %></dt>
      <dd class="col-sm-8">
        <%= "GDP" if @isometry.gdp %>
      </dd>

      <dt class="col-sm-4"><%= t('.ped_category') %></dt>
      <dd class="col-sm-8"><%= @isometry.ped_category %></dd>

      <dt class="col-sm-4"><%= t('.slope') %></dt>
      <dd class="col-sm-8"><%= @isometry.slope_if_needed %></dd>
    </dl>
  </div>

  <!-- app/views/isometries/show.html.erb -->
<div class="row">
  <div class="col-md-4">
    <dl>
      <dt><%= t('.rt_percentage') %></dt>
      <dd><%= number_to_percentage(@isometry.rt, precision: 1) if @isometry.rt %></dd>
    </dl>
    <% if @isometry.rt_images.attached? %>
      <%= render partial: 'images', locals: { 
        images: @isometry.rt_images, 
        title: t('.rt_images'),
        image_type: 'rt'
      } %>
    <% end %>
  </div>

  <div class="col-md-4">
    <dl>
      <dt><%= t('.vt_percentage') %></dt>
      <dd><%= number_to_percentage(@isometry.vt2, precision: 1) if @isometry.vt2 %></dd>
    </dl>
    <% if @isometry.vt_images.attached? %>
      <%= render partial: 'images', locals: { 
        images: @isometry.vt_images, 
        title: t('.vt_images'),
        image_type: 'vt'
      } %>
    <% end %>
  </div>

  <div class="col-md-4">
    <dl>
      <dt><%= t('.pt_percentage') %></dt>
      <dd><%= number_to_percentage(@isometry.pt2, precision: 1) if @isometry.pt2 %></dd>
    </dl>
    <% if @isometry.pt_images.attached? %>
      <%= render partial: 'images', locals: { 
        images: @isometry.pt_images, 
        title: t('.pt_images'),
        image_type: 'pt'
      } %>
    <% end %>
  </div>
</div>

</div>

<!-- Spooling -->
<div class="row mb-4">
  <div class="col-md-6">
    <h5 class="border-bottom pb-2 mb-3"><%= t('.spooling') %></h5>
    <dl class="row">
      <dt class="col-sm-4"><%= t('.total_pipe_length') %></dt>
      <dd class="col-sm-8"><%= number_with_precision(@isometry.pipe_length, precision: 2) %> m</dd>
   
      <dt class="col-sm-4"><%= t('.workshop_sn') %></dt>
      <dd class="col-sm-8"><%= @isometry.workshop_sn %></dd>

      <dt class="col-sm-4"><%= t('.assembly_sn') %></dt>
      <dd class="col-sm-8"><%= @isometry.assembly_sn %></dd>

      <dt class="col-sm-4"><%= t('.total_sn') %></dt>
      <dd class="col-sm-8"><%= @isometry.total_sn %></dd>

      <dt class="col-sm-4"><%= t('.total_supports') %></dt>
      <dd class="col-sm-8"><%= @isometry.total_supports %></dd>

      <dt class="col-sm-4"><%= t('.total_spools') %></dt>
      <dd class="col-sm-8"><%= @isometry.total_spools %></dd>
    </dl>
  </div>

  <div class="col-md-6">
    <h5 class="border-bottom pb-2 mb-3"><%= t('.on_hold_status') %></h5>
    <dl class="row">
      <dt class="col-sm-4"><%= t('.status') %></dt>
      <dd class="col-sm-8"><%= status_label(@isometry.on_hold_status) %></dd>

      <dt class="col-sm-4"><%= t('.comment') %></dt>
      <dd class="col-sm-8"><%= @isometry.on_hold_comment %></dd>

      <dt class="col-sm-4"><%= t('.date') %></dt>
      <dd class="col-sm-8"><%= l(@isometry.on_hold_date, format: :long) if @isometry.on_hold_date %></dd>
    </dl>
  </div>
</div>

<!-- Notes -->
<% if @isometry.notes.present? %>
  <div class="row mb-4">
    <div class="col-12">
      <h5 class="border-bottom pb-2 mb-3"><%= t('.notes') %></h5>
      <p class="text-muted"><%= @isometry.notes %></p>
    </div>
  </div>
<% end %>

<!-- Isometry Images -->
<% if @isometry.isometry_documents.any? %>
  <div class="row mb-4">
    <div class="col-12">
      <%= render partial: 'documents', locals: { 
        documents: @isometry.isometry_documents,
        title: t('.isometry_documents')
      } %>
    </div>
  </div>
<% end %>

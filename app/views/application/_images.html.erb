<%# app/views/isometries/_images.html.erb %>
<%
  # Ensure image_type is provided
  raise ArgumentError, "image_type must be provided" unless local_assigns[:image_type].present?
  # Default edit_mode to false if not provided
  edit_mode = local_assigns.fetch(:edit_mode, false)
%>

<% if images.attached? && !model_type.new_record? %>
  <div class="my-3" 
       data-controller="image-removal"
       data-image-removal-project-id-value="<%= @project.id %>"
       data-image-removal-model-id-value="<%= model_type.id %>"
       data-image-removal-model-type-value="<%= model_type.class.name.downcase %>">

    <% if local_assigns[:title].present? %>
      <h6 class="pb-2 mb-2"><%= title %></h6>
    <% end %>
    
    <div class="d-flex flex-wrap gap-2">
      <% images.each do |image| %>
        <div class="border rounded position-relative" 
             style="width: 90px;" 
             data-image-removal-target="imageContainer">
          <% if edit_mode %>
            <button type="button" 
                    class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1" 
                    style="font-size: 0.7rem; padding: 0.1rem 0.3rem;"
                    data-action="click->image-removal#removeImage"
                    data-image-removal-image-id-param="<%= image.signed_id %>"
                    data-image-removal-image-type-param="<%= image_type %>">Ã—</button>
          <% end %>
          <%= link_to url_for(image), target: "_blank", class: "text-decoration-none" do %>
            <div class="text-center">
              <i class="bi bi-file-image text-danger" style="font-size: 1.5rem;"></i>
              <div class="small text-dark text-truncate mt-1" title="<%= image.filename.to_s %>">
                <%= image.filename.to_s %>
              </div>
              <div class="text-muted" style="font-size: 0.7rem;">
                <%= number_to_human_size(image.byte_size) %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
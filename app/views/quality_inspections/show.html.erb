<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0"><%= t('.title') %></h5>
    <div>
      <%= link_to t('quality_inspections.buttons.edit'), edit_quality_inspection_path(@quality_inspection), class: 'btn btn-primary btn-sm' %>
      <%= link_to t('quality_inspections.buttons.back'), delivery_item_path(@quality_inspection.delivery_item), class: 'btn btn-secondary btn-sm' %>
    </div>
  </div>

  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <dl class="row">
          <dt class="col-sm-4"><%= t('.inspection_type') %></dt>
          <dd class="col-sm-8"><%= @quality_inspection.inspection_type.titleize %></dd>

          <dt class="col-sm-4"><%= t('.inspector') %></dt>
          <dd class="col-sm-8"><%= @quality_inspection.inspector_name %></dd>

          <dt class="col-sm-4"><%= t('.date') %></dt>
          <dd class="col-sm-8"><%= @quality_inspection.inspection_date.strftime("%Y-%m-%d %H:%M") %></dd>

          <dt class="col-sm-4"><%= t('.status') %></dt>
          <dd class="col-sm-8">
            <span class="badge <%= @quality_inspection.status == 'passed' ? 'bg-success' : 'bg-danger' %>">
              <%= @quality_inspection.status.upcase %>
            </span>
          </dd>
        </dl>
      </div>

      <div class="col-md-6">
        <dl class="row">
          <dt class="col-sm-4"><%= t('.notes') %></dt>
          <dd class="col-sm-8"><%= @quality_inspection.notes.presence || t('.no_notes') %></dd>
        </dl>
      </div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0"><%= t('quality_inspections.show.images.title') %></h5>
  </div>
  <div class="card-body">
    <% if @quality_inspection.images.attached? %>
      <div class="row">
        <% @quality_inspection.images.each do |image| %>
          <div class="col-md-3 mb-3" data-controller="modal">
            <%= image_tag image.variant(resize_to_limit: [150, 150]),
                class: "img-thumbnail",
                href: "#",
                data: {
                  action: "click->modal#open",
                  modal_target: "trigger"
                } %>

            <!-- Modal for this image -->
            <div class="modal fade"
                data-modal-target="dialog"
                tabindex="-1"
                aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Inspection Image</h5>
                    <button type="button"
                            class="btn-close"
                            data-action="modal#close"
                            aria-label="Close"></button>
                  </div>
                  <div class="modal-body text-center">
                    <%= image_tag image, class: "img-fluid" %>
                  </div>
                  <div class="modal-footer">
                    <%= link_to t('quality_inspections.buttons.download'),
                        rails_blob_path(image, disposition: "attachment"),
                        class: "btn btn-primary" %>
                    <button type="button"
                            class="btn btn-secondary"
                            data-action="modal#close">
                      <%= t('quality_inspections.buttons.close') %>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted"><%= t('quality_inspections.show.images.no_images') %></p>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h5 class="mb-0"><%= t('quality_inspections.show.defects.title') %></h5>
  </div>
  <div class="card-body">
    <% if @quality_inspection.inspection_defects.any? %>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th><%= t('quality_inspections.show.defects.description') %></th>
              <th><%= t('quality_inspections.show.defects.severity') %></th>
              <th><%= t('quality_inspections.show.defects.corrective_action') %></th>
            </tr>
          </thead>
          <tbody>
            <% @quality_inspection.inspection_defects.each do |defect| %>
              <tr>
                <td><%= defect.description %></td>
                <td>
                  <span class="badge bg-<%= defect.severity == 'critical' ? 'danger' : (defect.severity == 'major' ? 'warning' : 'info') %>">
                    <%= defect.severity.upcase %>
                  </span>
                </td>
                <td><%= defect.corrective_action.presence || t('quality_inspections.show.defects.pending') %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted"><%= t('quality_inspections.show.defects.no_defects') %></p>
    <% end %>
  </div>
</div>
